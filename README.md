リアルタイム脳波解析システム (ESP32 + Flutter + Python Server)
これは、自作の8チャンネル脳波計（ESP32-S3）から取得したデータを、スマートフォンアプリを経由してWindowsサーバーに送信し、MNE-Pythonライブラリを用いてリアルタイムで解析・可視化するためのフルスタックアプリケーションです。

✨ 主な機能
ハードウェア: Seeed Studio XIAO ESP32S3 を使用した8チャンネル脳波データ取得

データ圧縮: zstandardライブラリによる高効率なデータ圧縮・転送

リアルタイム通信: BLEによる安定したデータストリーミング（ACKフロー制御付き）

スマホアプリ: Flutterによるクロスプラットフォーム対応

生波形（8ch）のリアルタイムスクロール表示

サーバーで解析された結果（画像・数値）の表示

サーバーサイド解析: Python (Flask + MNE) による脳波解析

SQLiteデータベースへのデータ永続化

周波数スペクトル解析 (PSD): 各チャンネルのパワースペクトルを色分け表示

同期度解析 (Coherence): 電極間の結合度を円グラフで可視化

🚀 アーキテクチャ
本システムは、役割を明確に分離した3つのコンポーネントで構成されています。

Firmware (ESP32): センサーデータの取得、タイムスタンプ付与、圧縮に専念します。

Mobile App (Flutter): ESP32とサーバーを中継し、生波形と解析結果の両方を表示するユーザーインターフェースです。

Server (Python): データを受け取ってDBに保存し、バックグラウンドでMNEによる重い解析処理を実行します。

🔧 開発環境のセットアップ
このリポジトリをクローンした後、各コンポーネントを以下の手順でセットアップしてください。

1. Server (Python / Windows)
解析の心臓部となるPythonサーバーをセットアップします。

仮想環境の作成:

# /server ディレクトリに移動
cd server

# 仮想環境を作成
python -m venv venv

# 仮想環境を有効化
.\venv\Scripts\activate

ライブラリのインストール:

# 必要なライブラリをすべてインストール
pip install -r requirements.txt

サーバーの起動:

python server.py

警告が出ますが気にしなくて大丈夫です．
サーバーが http://0.0.0.0:5000 でリクエストを待ち受けます。

2. Firmware (ESP32)
PlatformIOを使用したESP32のファームウェアです。

VSCodeで開く: VSCodeで、このリポジトリのルートフォルダ（eeg-analysis-system）を開きます。

PlatformIOでビルド & アップロード: PlatformIO拡張機能が自動的に /firmware ディレクトリをプロジェクトとして認識します。

左下のチェックマーク（✔）アイコンでビルドします。

矢印（→）アイコンでESP32にファームウェアを書き込みます。

3. Mobile App (Flutter)
リアルタイム表示とサーバーへのデータ中継を行うスマホアプリです。

サーバーIPアドレスの設定:

mobile_app/lib/analysis_provider.dart ファイルを開きます。

serverIp 定数の値を、上記でサーバーを起動しているPCのIPアドレスに書き換えてください。

// 例:
const String serverIp = "192.168.1.10"; 

ライブラリのインストール:
まず，新しくターミナルを開きます．
# /mobile_app ディレクトリに移動
cd mobile_app

# 依存パッケージを取得
flutter pub get

アプリの実行:

Androidの実機をPCに接続します。
実機側の準備として，以下を行ってください．
1. **「設定」**アプリを開きます。
2. 一番下までスクロールし、**「デバイス情報」**をタップします。
3. 一番下にある**「ビルド番号」を7回連続でタップ**します。（「これでデベロッパーになりました！」と表示されます）
4. 一つ前の画面に戻り、「システム」 > **「開発者向けオプション」**に進みます。
5. 「開発者向けオプション」がONになっていることを確認し、中にある**「USBデバッグ」のスイッチを一度OFFにしてから、もう一度ON**に切り替えてください。
6. PCとの接続を許可するか尋ねるポップアップが表示されたら、**「許可」**をタップします。
7. USB接続します．USB接続モードが 充電 ではなく ファイル転送 / Android Auto になっているか確認してください．
8. 接続デバイスに実機が認識されているか確認してください．
以下のコマンドでアプリを起動します。

flutter run

⚙️ .gitignore の設定
リポジトリをクリーンに保つため、各プロジェクトフォルダに以下の内容で .gitignore ファイルを作成してください。

/firmware/.gitignore
.pio/
.vscode/

/mobile_app/.gitignore
(Flutterが自動生成するデフォルトの .gitignore をそのまま使用してください)

/server/.gitignore
venv/
__pycache__/
*.pyc
eeg_data.db
